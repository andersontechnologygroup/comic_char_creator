<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Super Hero Character Generator</title>
  <style>
    :root {
      --primary-color: #e23636;
      --secondary-color: #fca311;
      --dark-bg: #14213d;
      --light-text: #ffffff;
      --panel-bg: #e5e5e5;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f0f0f0;
      color: #333;
      margin: 0;
      padding: 20px;
    }

    header {
      background-color: var(--primary-color);
      color: white;
      padding: 20px;
      text-align: center;
      margin-bottom: 20px;
    }

    h1 {
      margin: 0;
      text-transform: uppercase;
      letter-spacing: 2px;
    }

    .controls {
      text-align: center;
      margin-bottom: 20px;
    }

    button {
      background-color: var(--dark-bg);
      color: white;
      border: none;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      border-radius: 4px;
      transition: background 0.3s;
    }

    button:hover {
      background-color: var(--secondary-color);
      color: black;
    }

    .character-sheet {
      background-color: white;
      max-width: 900px;
      margin: 0 auto;
      padding: 10px;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      border-top: 10px solid var(--primary-color);
    }

    .section-title {
      grid-column: 1 / -1;
      background-color: var(--dark-bg);
      color: white;
      padding: 5px 10px;
      text-transform: uppercase;
      font-weight: bold;
      margin-top: 10px;
    }

    .list-section {
      grid-column: 1 / -1;
    }

    .stat-block {
      display: grid;
      grid-template-columns: 1fr auto auto;
      gap: 10px;
      padding: 5px 0;
      border-bottom: 1px solid #ccc;
    }

    .stat-label {
      font-weight: bold;
    }

    .stat-rank {
      color: var(--primary-color);
      font-weight: bold;
    }

    .stat-rank-multiple {
      font-size: 10pt;
    }

    .stat-number {
      color: #666;
      font-family: monospace;
    }

    .secondary-block {
      background-color: var(--panel-bg);
      padding: 15px;
      text-align: center;
      border-radius: 5px;
    }

    .secondary-value {
      font-size: 24px;
      font-weight: bold;
      color: var(--dark-bg);
    }

    .info-header {
      grid-column: 1 / -1;
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }

    .info-header-ultimate {
      grid-column: 1 / -1;
      display: grid;
      grid-template-columns: 1fr 1fr 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }

    .info-header-ultimate-no-bottom {
      grid-column: 1 / -1;
      display: grid;
      grid-template-columns: 1fr 1fr 1fr 1fr;
      gap: 20px;
    }

    .info-header-single {
      grid-column: 1 / -1;
      display: grid;
      grid-template-columns: 1fr;
      gap: 20px;
    }

    .info-item span {
      font-weight: bold;
      display: block;
      color: #666;
      font-size: 0.8em;
    }

    .list-section ul {
      margin: 0;
      padding-left: 20px;
    }

    .roll-log {
      grid-column: 1 / -1;
      background: #333;
      color: #0f0;
      font-family: monospace;
      padding: 15px;
      max-height: 200px;
      overflow-y: auto;
      margin-top: 20px;
      font-size: 0.9em;
    }

    .test-output {
      background: #eee;
      border: 1px solid #ccc;
      padding: 10px;
      margin-top: 20px;
      font-family: monospace;
    }

    .pass {
      color: green;
    }

    .fail {
      color: red;
    }

    .weakness {
      font-size: 12pt;
    }

    .power {
      font-size: 12pt;
    }

    .talent {
      font-size: 12pt;
    }

    .contact {
      font-size: 12pt;
    }

    .weakness-description {
      font-size: 8pt;
    }

    .multiple-slots {
      font-size: smaller;
      vertical-align: super;
    }

    .bonus-power {
      font-size: smaller;
      vertical-align: super;
    }

    .power-description {
      font-size: 8pt;
    }

    .talent-description {
      font-size: 8pt;
    }

    .contact-description {
      font-size: 8pt;
    }

    .side-by-side {
      display: grid;
      gap: 20px 20px;
      width: 100%;
      grid-template-columns: repeat(4, 1fr);
      padding: 10px;
      box-sizing: border-box;
      grid-column: 1 / -1;
    }

    details.about {
      max-width: 900px;
      margin: 0 auto;
    }

    details.about summary {
      font-size: 8pt;
    }

    details.about>div {
      border: 1px solid black;
      padding: 3px;
      margin-bottom: 4px;
      font-size: 8pt;
    }

    details.options {
      max-width: 900px;
      margin: 0 auto;
    }

    details.options summary {
      font-size: 8pt;
    }

    details.options>div {
      border: 1px solid black;
      padding: 3px;
      margin-bottom: 4px;
      display: grid;
      grid-column: 1 / -1;
      grid-template-columns: 1fr;
    }

    p.center {
      text-align: center;
    }

    @media print {
      body {
        padding: 0;
        background-color: transparent;
      }

      header {
        padding: 5px 5px 5px 5px;
        margin-bottom: 0;
      }

      header h1 {
        font-size: 12pt;
      }

      .controls {
        margin-bottom: 0;
      }

      .character-sheet {
        gap: 5px 10px;
        border-top: none;
        padding: 0;
        background-color: transparent;
        box-shadow: none;
      }

      .section-title {
        margin-top: 0;
      }

      .info-header {
        margin-bottom: 0;
      }

      .list-section {
        margin-bottom: 0;
      }

      .stat-block {
        margin-bottom: 0;
      }

      .stat-label {
        font-size: 8pt;
      }

      .stat-rank {
        font-size: 8pt;
      }

      .stat-number {
        font-size: 8pt;
      }

      .secondary-block {
        padding: 4px;
        font-size: 8pt;
      }

      .secondary-value {
        font-size: 10pt;
      }

      .side-by-side {
        padding: 2px;
      }

      .weakness {
        font-size: 10pt;
      }

      .power {
        font-size: 10pt;
      }

      .talent {
        font-size: 10pt;
      }

      .contact {
        font-size: 10pt;
      }

      .no-print {
        display: none;
      }
    }
  </style>
</head>

<body>

  <details class="about no-print">
    <summary>About</summary>
    <div>
      <p>I have been a collector of comic books for over 40 years. One of my favorite books was the Official Handbook to
        the Marvel Universe. This provided simple descriptions of the characters, including powers, talents, group
        affiliations, contacts, etc. This format inspired me to create new characters using a very simple random number
        generator and a set of rules that I created. The details of those rules are now lost to my childhood. Many years
        ago I came across the Marvel Super Heroes RPG by TSR and was immediately drawn to the system. I have never been
        an RPG player, but the system provided a simple character generation system.</p>
      <p>This character generator is based (heavily) on the Marvel Super Heroes Advanced Rulebook. With v3.0, the
        generator
        mode can be switch between Generic, Advanced, and Ultimate mode, allowing you to generate characters for fun or
        for
        RPG purposes.</p>
      <p>
        I am still in th process of finishing up v3.0. You can take a look at the TODO list to see what is left. There
        are a small
        handful of Physical Form attributes that are currently not working. I also haven't put more than very generic
        descriptions for the Powers.
        Currently, Ultimate mode is using the samee Talents as the Advanced mode. I plan to add the unofficial Ultimate
        Talents
        to the Ultimate mode. I will also be eenhancing the Contacts types for the Ultimate mode.
      </p>
      <br>
      <p class="center">
        TSR is a registered trademark owned by TSR Inc. TSR inc. is a subsidiary of Wizards of the Coast, Inc., a
        division of Hasbro, Inc.<br>
        Names(s) of character(s) and the distinctive likeness(es) thereof are Trademarks and © of Marvel Characters,
        Inc. and are used without permission.<br>
        Names(s) of character(s) and the distinctive likeness(es) thereof are Trademarks and © of DC Comics and are used
        without permission.<br>
        This site is not intended to make money. It provides resources to players of a game no longer being produced.
      </p>
    </div>
  </details>

  <header>
    <h1>Super Hero Character Generator v3.0</h1>
  </header>

  <div class="controls no-print">
    <button onclick="app.generate()">Generate New Hero</button>
    <button onclick="app.runTests()">Run Unit Tests</button>
    <button onclick="print()">Print Hero Sheet</button>
  </div>

  <details class="options no-print">
    <summary>Options</summary>
    <div>
      <div>
        <label>Generator:</label>
        <input type="radio" name="generator" id="generator_generic" value="generic" checked />
        <label for="generator_generic"
          title="Generic mode provides a simple character generation system.  It is intended to be used for non-RPG purposes.  Powers, Talents, and Contacts have generic descriptions.   Abilities do not have rank values associated.">Generic</label>
        <input type="radio" name="generator" id="generator_advanced" value="advanced" />
        <label for="generator_advanced"
          title="Advanced mode provides a more complex character generation system.  It is intended to be used for RPG purposes.  Powers, Talents, and Contacts have detailed descriptions.   Abilities have rank values associated.  Physical Forms, Powers, Talents, and Contacts are based on the Marvel Super Heroes Advanced Players Book.">Advanced</label>
        <input type="radio" name="generator" id="generator_ultimate" value="ultimate" />
        <label for="generator_ultimate"
          title="Ultimate mode provides a more complex character generation system.  It is intended to be used for RPG purposes.  Powers, Talents, and Contacts have detailed descriptions.   Abilities have rank values associated.  Physical Forms, Powers, Talents, and Contacts are based on the Marvel Super Heroes The Ultimate Powers Book.">Ultimate</label>
      </div>
    </div>
    <div>
      <div>
        <label>Identity:</label>
        <input type="radio" name="identity" id="identity_secret" checked />
        <label for="identity_secret">Secret</label>
        <input type="radio" name="identity" id="identity_public" />
        <label for="identity_public">Public</label>
      </div>
      <div>
        <label>If Hi-Tech:</label>
        <input type="radio" name="hi_tech" id="hi_tech_good" checked />
        <label for="hi_tech_good">Set Resources to Good</label>
        <input type="radio" name="hi_tech" id="hi_tech_roll" />
        <label for="hi_tech_roll">Roll for Resources</label>
      </div>
    </div>
    <div>
      <div>
        <label>Render Tests:</label>
        <select id="render-tests">
        </select>
      </div>
      <div>
        <label>Tests to Run:</label>
        <input type="radio" name="unit-tests-to-run" id="run-unit-tests" />
        <label for="run-unit-tests">Unit Tests</label>
        <input type="radio" name="unit-tests-to-run" id="run-render-tests" />
        <label for="run-render-tests">Render Tests</label>
        <input type="radio" name="unit-tests-to-run" id="run-both-tests" checked />
        <label for="run-both-tests">Both</label>
      </div>
    </div>
  </details>

  <div id="display-area"></div>
  <div class="no-print" id="test-area"></div>

  <script type="text/javascript" src="Charactor.js"></script>
  <script type="text/javascript" src="CharactorGenerator.js"></script>
  <script type="text/javascript" src="DataGeneric.js"></script>
  <script type="text/javascript" src="DataAdvanced.js"></script>
  <script type="text/javascript" src="DataUltimate.js"></script>
  <script type="text/javascript" src="Utility.js"></script>
  <script type="text/javascript" src="UnitTests.js"></script>

  <script type="text/javascript">
    const ABILITY_MODIFIER_TABLE = [
      { maxRoll: 15, modifier: -1 },
      { maxRoll: 50, modifier: 0 },
      { maxRoll: 70, modifier: 1 },
      { maxRoll: 85, modifier: 2 },
      { maxRoll: 95, modifier: 3 },
      { maxRoll: 100, modifier: 4 }
    ];

    const ALL_ABILITIES = [
      { name: "Fighting", maxRoll: 14 },
      { name: "Agility", maxRoll: 29 },
      { name: "Strength", maxRoll: 43 },
      { name: "Endurance", maxRoll: 58 },
      { name: "Reason", maxRoll: 72 },
      { name: "Intuition", maxRoll: 86 },
      { name: "Psyche", maxRoll: 100 },
    ];
    const PHYSICAL_ABILITIES = ["Fighting", "Agility", "Strength", "Endurance"];
    const MENTAL_ABILITIES = ["Reason", "Intuition", "Psyche"];

    // --- CLASSES ---
    class Renderer {
      static render(char, mode) {
        const display = document.getElementById('display-area');

        let powersHtml = char.powers.map(p => `<li class="power"><strong>${mode === 'ultimate' ? `${p.code}/` : ''}${p.name}${p.powerSlots > 1 ? `<span class="multiple-slots">*</span>` : ``}${p.bonusPower ? ` <span class="bonus-power">B</span>` : ``}</strong>: ${mode !== 'generic' ? ` ${p.rank} (${p.number})` : ``} &nbsp; <span class="power-description">${p.description}</span></li>`).join('');
        let talentsHtml = char.talents.map(t => `<li class="talent"><strong>${t.category}: ${t.name}${t.talentSlots > 1 ? `<span class="multiple-slots">*</span>` : ``}</strong> &nbsp; <span class="talent-description">${t.description}</span></li>`).join('');
        let contactsHtml = char.contacts.map(c => `<li class="contact"><strong>${c.category}/${c.name}</strong> &nbsp; <span class="contact-description">${c.description}</span></li>`).join('');
        let logHtml = char.log.map(l => `<div>${l}</div>`).join('');

        let powers = char.powers.map(item => item.powerSlots).reduce((accumulator, currentValue) => accumulator + currentValue, 0);
        let talents = char.talents.map(item => item.talentSlots).reduce((accumulator, currentValue) => accumulator + currentValue, 0);

        let html = `
            <div class="character-sheet">
                <div class="section-title">Identity</div>`;

        if (mode !== 'ultimate') {
          html += `
                <div class="info-header">
                    <div class="info-item"><span>Name</span> ${char.name}</div>
                    <div class="info-item"><span>Origin</span> ${char.physicalForm}</div>
                    <div class="info-item"><span>Identity</span> ${char.identity}</div>
                </div>`;
        }

        if (mode === 'ultimate') {
          let physicalForm = char.physicalForm;
          if (char.subType !== "") physicalForm += ` (${char.subType})`;

          let infoHeader = "info-header-ultimate";
          if (char.bodyTypes.length > 1) infoHeader = "info-header-ultimate-no-bottom";

          html += `
                <div class="${infoHeader}">
                    <div class="info-item"><span>Name</span> ${char.name}</div>
                    <div class="info-item"><span>Physical Form</span> ${physicalForm}</div>
                    <div class="info-item"><span>Origin</span> ${char.origin}</div>
                    <div class="info-item"><span>Identity</span> ${char.identity}</div>
                </div>`;

          if (char.bodyTypes.length > 1) {
            let bodyTypeHtml = "";
            for (let index = 0; index < char.bodyTypes.length; index++) {
              bodyTypeHtml += `${char.bodyTypes[index]} / `;
            }

            bodyTypeHtml = bodyTypeHtml.slice(0, -2);

            html += `
                <div class="info-header-single">
                    <div class="info-item"><span>Body Types</span>${bodyTypeHtml}</div>
                </div>`;
          }
        }

        if (char.primaryAbilities.length === 1) {
          html += `
                <div class="section-title">Primary Abilities (FASERIP)</div>
                <div class="stat-block">
                    <span class="stat-label">Fighting</span>
                    <span class="stat-rank">${char.primaryAbilities[0].Fighting.rank}</span>
                    <span class="stat-number">${mode === 'generic' ? "" : char.primaryAbilities[0].Fighting.number}</span>
                </div>
                <div class="stat-block">
                    <span class="stat-label">Agility</span>
                    <span class="stat-rank">${char.primaryAbilities[0].Agility.rank}</span>
                    <span class="stat-number">${mode === 'generic' ? "" : char.primaryAbilities[0].Agility.number}</span>
                </div>
                <div class="stat-block">
                    <span class="stat-label">Strength</span>
                    <span class="stat-rank">${char.primaryAbilities[0].Strength.rank}</span>
                    <span class="stat-number">${mode === 'generic' ? "" : char.primaryAbilities[0].Strength.number}</span>
                </div>
                <div class="stat-block">
                    <span class="stat-label">Endurance</span>
                    <span class="stat-rank">${char.primaryAbilities[0].Endurance.rank}</span>
                    <span class="stat-number">${mode === 'generic' ? "" : char.primaryAbilities[0].Endurance.number}</span>
                </div>`;
        }
        else {
          let fighting = "";
          let agility = "";
          let strength = "";
          let endurance = "";

          for (let index = 0; index < char.primaryAbilities.length; index++) {
            fighting += `<span class="stat-rank-multiple">${char.primaryAbilities[index].Fighting.rank}</span> <span class="stat-number">${char.primaryAbilities[index].Fighting.number}</span> / `;
            agility += `<span class="stat-rank-multiple">${char.primaryAbilities[index].Agility.rank}</span> <span class="stat-number">${char.primaryAbilities[index].Agility.number}</span> / `;
            strength += `<span class="stat-rank-multiple">${char.primaryAbilities[index].Strength.rank}</span> <span class="stat-number">${char.primaryAbilities[index].Strength.number}</span> / `;
            endurance += `<span class="stat-rank-multiple">${char.primaryAbilities[index].Endurance.rank}</span> <span class="stat-number">${char.primaryAbilities[index].Endurance.number}</span> / `;
          }

          fighting = fighting.slice(0, -2);
          agility = agility.slice(0, -2);
          strength = strength.slice(0, -2);
          endurance = endurance.slice(0, -2);

          html += `
                <div class="section-title">Primary Abilities (FASERIP)</div>
                <div class="stat-block">
                    <span class="stat-label">Fighting</span>
                    <span class="stat-rank">${fighting}</span>
                </div>
                <div class="stat-block">
                    <span class="stat-label">Agility</span>
                    <span class="stat-rank">${agility}</span>
                </div>
                <div class="stat-block">
                    <span class="stat-label">Strength</span>
                    <span class="stat-rank">${strength}</span>
                </div>
                <div class="stat-block">
                    <span class="stat-label">Endurance</span>
                    <span class="stat-rank">${endurance}</span>
                </div>`;
        }

        html += `<div class="stat-block">
                    <span class="stat-label">Reason</span>
                    <span class="stat-rank">${char.primaryAbilities[0].Reason.rank}</span>
                    <span class="stat-number">${mode === 'generic' ? "" : char.primaryAbilities[0].Reason.number}</span>
                </div>
                <div class="stat-block">
                    <span class="stat-label">Intuition</span>
                    <span class="stat-rank">${char.primaryAbilities[0].Intuition.rank}</span>
                    <span class="stat-number">${mode === 'generic' ? "" : char.primaryAbilities[0].Intuition.number}</span>
                </div>
                <div class="stat-block">
                    <span class="stat-label">Psyche</span>
                    <span class="stat-rank">${char.primaryAbilities[0].Psyche.rank}</span>
                    <span class="stat-number">${mode === 'generic' ? "" : char.primaryAbilities[0].Psyche.number}</span>
                </div>

                <div class="section-title">Secondary Abilities</div>

                <div class="side-by-side">
                <div class="secondary-block">
                    <div class="secondary-value">${char.health}</div>
                    <div>Health</div>
                </div>
                <div class="secondary-block">
                    <div class="secondary-value">${char.karma}</div>
                    <div>Karma</div>
                </div>
                <div class="secondary-block">
                    <div class="secondary-value">${char.resources.rank}</div>
                    <div>Resources</div>
                </div>
                <div class="secondary-block">
                    <div class="secondary-value">${char.popularity}</div>
                    <div>Popularity</div>
                </div>
                </div>`;

        //        let powersHtml = char.powers.map(p => `<li class="power"><strong>${p.name}${p.powerSlots > 1 ? `*` : ``}${p.bonusPower ? ` (B)` : ``}</strong>: ${mode !== 'generic' ? `(${p.number})` : ``} &nbsp; <span class="power-description">${p.description}</span></li>`).join('');

        if (mode === 'ultimate') {
          html += `
                <div class="section-title">Weakness</div>
                <div class="list-section"><ul><li class="weakness"><strong>Stimulus: ${char.weakness.stimulus}</strong> &nbsp; <span class="power-description">${char.weakness.stimulusDescription}</span></li>
                <li class="weakness"><strong>Effect: ${char.weakness.effect}</strong> &nbsp; <span class="power-description">${char.weakness.effectDescription}</span></li>
                <li class="weakness"><strong>Duration: ${char.weakness.duration}</strong> &nbsp; <span class="power-description">${char.weakness.durationDescription}</span></li></ul></div>`;

          if (char.weakness.stimulus === 'Finite Limit') {
            html = html.slice(0, -11);

            html += `
                <li class="weakness"><strong>Rank: ${char.weakness.rank}</strong> &nbsp; <span class="power-description">${char.weakness.rankNumber}</span></li></ul></div>`;
          }
        }

        html += `
                <div class="section-title">Powers (${powers}/${char.powersMax})</div>
                <div class="list-section"><ul>${powersHtml || "<li>None</li>"}</ul></div>

                <div class="section-title">Talents (${talents}/${char.talentsMax})</div>
                <div class="list-section"><ul>${talentsHtml || "<li>None</li>"}</ul></div>

                <div class="section-title">Contacts (${char.contacts.length}/${char.contactsMax})</div>
                <div class="list-section"><ul>${contactsHtml || "<li>None</li>"}</ul></div>

                <div class="section-title no-print">Generation Log</div>
                <div class="roll-log no-print">${logHtml}</div>
            </div>
        `;
        display.innerHTML = html;
      }
    }

    // --- APP CONTROLLER ---
    const app = {
      generate: () => {
        const generator = new CharacterGenerator();
        generator.identitySecret = document.getElementById('identity_secret').checked;
        generator.hiTechToGood = document.getElementById('hi_tech_good').checked;

        const advanced = document.getElementById('generator_advanced').checked;
        const ultimate = document.getElementById('generator_ultimate').checked;

        generator.generatorMode = 'generic';
        if (advanced && !ultimate) generator.generatorMode = 'advanced';
        if (!advanced && ultimate) generator.generatorMode = 'ultimate';

        const character = generator.generate();
        Renderer.render(character, generator.generatorMode);
        document.getElementById('test-area').innerHTML = ""; // Clear tests
      },
      runTests: () => {
        const unitTests = document.getElementById('run-unit-tests').checked;
        const renderTests = document.getElementById('run-render-tests').checked;
        const bothTests = document.getElementById('run-both-tests').checked;

        document.getElementById('display-area').innerHTML = "";
        document.getElementById('test-area').innerHTML = "";

        if (unitTests || bothTests) {
          Tester.run();
        }
        if (renderTests || bothTests) {
          const select = document.getElementById('render-tests').value;
          Tester[select]();
        }
      },
      populateRenderTests: () => {
        const tests = Tester.getRenderMethodNames();
        const select = document.getElementById('render-tests');
        tests.forEach(test => {
          const option = document.createElement('option');
          option.value = test;
          option.text = test.replace("Render", "").replace("Test", "").replace(/_/g, " ");
          select.appendChild(option);
        });
      }
    };

    app.populateRenderTests();

    // Initial Generation
    //app.generate();
    app.runTests();

    // TODO #4 Verify power list ultime table data
    // TODO #3 Redo Unit Test Powers Single Ultimatee
    // TODO #2 Redo Unit Test SpecialAbilities Powers Ultimate
    // TODO #1 Finish PowersTooMany test for Ultimate

  </script>
</body>

</html>